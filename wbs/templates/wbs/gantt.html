{# templates/wbs/gantt.html #}
{% extends "base.html" %}
{% load static %}
{% now "U" as timestamp %}

{% block title %}Gantt Chart{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'wbs/gantt.css' %}?v={{ timestamp }}">
<style>
  html, body {
    height: 100%;
    overflow: hidden;
    margin: 0;
    padding: 0;
  }

  body {
    display: flex;
    flex-direction: column;
  }

  .site-header {
    flex-shrink: 0;
    z-index: 1001;
  }

  .page-wrapper {
    flex: 1;
    padding: 0;
    margin: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .site-footer {
    display: none;
  }

  #gantt-root {
    flex: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    padding: 0;
  }

  .gantt-header {
    flex-shrink: 0;
    order: 1;
    padding: 12px 12px 6px;
    margin-bottom: 12px;
  }

  .gantt-filters {
    flex-shrink: 0;
    order: 3;
    max-height: 30vh;
    overflow-y: auto;
    padding: 12px;
    margin-bottom: 12px;
  }

  .gantt-legend {
    flex-shrink: 0;
    order: 4;
    padding: 8px 12px;
    margin-bottom: 12px;
  }

  .gantt-container {
    order: 2;
    flex: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-height: 65vh;
  }

  .gantt-layout {
    display: flex;
    gap: 12px;
    align-items: stretch;
    flex: 1;
    overflow: hidden;
    min-height: 0;
  }

  .gantt-main {
    flex: 1;
    min-width: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  .gantt-container {
    background: #fff;
    border-radius: 8px;
    padding: 12px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex: 1;
    overflow: hidden;
  }

  .gantt-scroll {
    flex: 1;
    overflow: auto;
    position: relative;
    isolation: isolate;
    background: #fff;
    scrollbar-gutter: stable both-edges;
    min-height: 0;
  }

  /* Ensure scrollbars are visible */
  .gantt-scroll::-webkit-scrollbar {
    width: 12px;
    height: 12px;
  }

  .gantt-scroll::-webkit-scrollbar-track {
    background: var(--panel-accent);
  }

  .gantt-scroll::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 6px;
  }

  .gantt-scroll::-webkit-scrollbar-thumb:hover {
    background: var(--muted);
  }

  /* Dependency overlay SVG positioning */
  #dependency-svg {
    position: absolute;
    top: 0;
    left: 0;
    pointer-events: none;
    z-index: 5;
    width: 100%;
    min-height: 100%;
    overflow: visible;
  }

  .detail-panel {
    flex: 0 0 320px;
    max-width: 320px;
    border-left: 1px solid #e5e5e5;
    padding-left: 12px;
    font-size: 12px;
  }

  .detail-panel.collapsed {
    display: none;
  }

  .hidden-project-items {
    display: none !important;
  }

  .bar-cell {
    position: relative;
    padding-left: 0;
    overflow: hidden;
    border-left: 1px solid #ddd;
    min-width: var(--timeline-width, 0px);
    display: flex;
    align-items: center;
    height: 28px;
  }

  .bar-wrapper {
    position: relative;
    height: 16px;
    min-width: 0;
    display: flex;
    align-items: center;
  }

  .bar {
    position: relative;
    height: 10px;
    border-radius: 5px;
    background: #d1e4ff;
    overflow: hidden;
  }

  /* Theme-aware overrides */
  table {
    background: var(--card);
    color: var(--text);
  }

  thead {
    background: var(--panel-accent);
    color: var(--text);
  }

  tbody tr {
    background: var(--card) !important;
    color: var(--text);
    border-color: var(--border);
  }

  tbody tr:hover {
    background: var(--panel-accent) !important;
  }

  td, th {
    border-color: var(--border);
    color: var(--text);
  }

  .gantt-container {
    background: var(--card);
    color: var(--text);
  }

  .gantt-scroll {
    background: var(--card);
    color: var(--text);
  }

  .gantt-header {
    background: var(--panel);
    color: var(--text);
    border-bottom-color: var(--border);
  }

  .gantt-filters {
    background: var(--panel);
    color: var(--text);
    border-bottom-color: var(--border);
  }

  .gantt-legend {
    background: var(--panel-accent);
    color: var(--text);
    border-color: var(--border);
  }

  /* Legend swatch styling */
  .legend-swatch {
    width: 16px;
    height: 3px;
    border-radius: 2px;
    display: inline-block;
    background: #42c778;
  }

  .legend-swatch.dep-type-fs {
    background: #42c778;
  }

  .legend-swatch.dep-type-ss {
    background: #4da3ff;
    border-bottom: 1px dashed #4da3ff;
  }

  .legend-swatch.dep-type-ff {
    background: #f39c12;
    border-bottom: 1px dotted #f39c12;
  }

  .legend-swatch.dep-type-sf {
    background: #e56bff;
    border-bottom: 1px dotted #e56bff;
  }

  .legend-swatch.critical-path-swatch {
    width: 16px;
    height: 8px;
    background: #ef4444;
    border: 1px solid #dc2626;
    border-radius: 2px;
  }

  .bar-cell {
    border-left-color: var(--border);
  }

  .bar-header {
    border-left-color: var(--border);
  }

  .col-code, .col-task, .col-start, .col-end {
    background: var(--card);
    border-right-color: var(--border);
  }

  .header-cols-row th {
    background: var(--panel-accent);
    border-color: var(--border);
  }

  .header-timeline-row th {
    background: var(--card);
  }

  .timeline {
    color: var(--text);
  }

  .year-band, .month-band, .day-label {
    color: var(--muted);
  }

  .day-tick {
    border-color: var(--border);
  }

  .expander {
    background: var(--panel-accent);
    border-color: var(--border);
    color: var(--text);
  }

  .expander[data-expanded="true"] {
    background: var(--accent);
    border-color: var(--accent);
  }

  input[type="text"], input[type="checkbox"], input[type="radio"] {
    background: var(--panel);
    color: var(--text);
    border-color: var(--border);
  }

  input[type="text"]:focus {
    outline-color: var(--accent);
    border-color: var(--accent);
  }

  button {
    background: var(--panel-accent);
    color: var(--text);
    border-color: var(--border);
  }

  button:hover {
    background: var(--panel);
    border-color: var(--accent);
  }

  .gantt-link-button {
    background: var(--accent) !important;
    border-color: var(--accent) !important;
    color: white !important;
  }

  .gantt-link-button:hover {
    background: var(--accent-strong) !important;
    border-color: var(--accent-strong) !important;
  }

  .bulk-actions-toolbar {
    background: var(--panel-accent);
    border-color: var(--border);
  }

  .filter-group-title {
    color: var(--text);
  }

  .filter-note {
    color: var(--muted);
  }

  /* Timeline theme overrides */
  .timeline-track {
    background: var(--panel-accent);
    border-bottom-color: var(--border);
  }

  .timeline-row {
    border-bottom-color: var(--border);
  }

  .year-band {
    background: var(--panel);
    border-left-color: var(--border);
    border-right-color: var(--border);
    color: var(--text);
  }

  .month-band {
    background: var(--panel-accent);
    border-left-color: var(--border);
    border-right-color: var(--border);
    color: var(--text);
  }

  .day-tick {
    background: var(--border);
  }

  .day-label {
    color: var(--muted);
    background: rgba(0, 0, 0, 0.1);
  }

  /* Timeline positioning fixes */
  .timeline {
    position: relative;
    overflow: visible;
    height: 60px;
  }

  .timeline-track {
    position: relative;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .timeline-row {
    position: relative;
    flex: 0 0 20px;
    height: 20px;
    overflow: visible;
    font-size: 10px;
  }

  .year-band {
    position: absolute;
    top: 2px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    white-space: nowrap;
    font-weight: 600;
  }

  .month-band {
    position: absolute;
    top: 2px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    white-space: nowrap;
  }

  .day-tick {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 1px;
    background: var(--border);
  }

  .day-label {
    position: absolute;
    top: 2px;
    left: 0;
    transform: none;
    font-size: 9px;
    white-space: nowrap;
    padding: 0 2px;
    min-width: 20px;
    text-align: center;
  }
</style>
{% endblock %}

{% block content %}
  <div id="gantt-root" data-px-per-day="{{ px_per_day }}" data-min-start="{{ min_start|date:'Y-m-d' }}" data-timeline-width="{{ timeline_width_px }}" style="--timeline-width: {{ timeline_width_px }}px;">
  <div class="gantt-header">
    <div class="gantt-header-top">
      <div>
        <h1>Gantt Chart</h1>
      </div>

          <div class="gantt-header-actions">
            <button type="button" id="show-keyboard-help" aria-label="Show keyboard shortcuts" onclick="document.getElementById('keyboard-help-modal').style.display='flex'">
              ‚å®Ô∏è Shortcuts
            </button>
            <button type="button" id="toggle-theme" aria-label="Toggle dark mode">Dark Mode</button>
            <button type="button" id="zoom-out" aria-label="Zoom out">Zoom -</button>
            <button type="button" id="zoom-in" aria-label="Zoom in">Zoom +</button>
            <button type="button" id="zoom-reset" aria-label="Reset zoom">Reset Zoom</button>
            <button type="button" id="toggle-critical-path" aria-label="Toggle critical path" title="Highlight critical path">
              üìç Critical Path
            </button>
            <button type="button" id="toggle-baseline" aria-label="Toggle baseline comparison" title="Show planned vs actual dates">
              üìä Baseline
            </button>
            <button type="button" id="export-gantt" aria-label="Export Gantt as PNG">Export PNG</button>
            <button type="button" id="optimize-schedule" aria-label="Optimize schedule">Optimize Schedule</button>
            <button type="button" id="expand-all" aria-label="Expand all tasks">Expand All</button>
            <button type="button" id="collapse-all" aria-label="Collapse all tasks">Collapse All</button>
            <button type="button" id="toggle-project-panel" aria-label="Toggle project items panel">Toggle Project Items</button>
          </div>
        </div>
        {% if min_start and max_end %}
      <div class="gantt-meta">
        Range: {{ min_start }} ‚Üí {{ max_end }} ({{ total_days }} days)
      </div>
    {% else %}
      <div class="gantt-meta">
        No tasks with planned dates found. Run <code>auto_schedule_wbs</code> or set dates.
      </div>
    {% endif %}
  </div>

  <div class="gantt-filters">
    <form class="filter-form" method="get">
      <div class="filter-group">
        <label for="gantt-search">Search Tasks</label>
        <div class="search-autocomplete-wrapper">
          <input
            type="text"
            id="gantt-search"
            name="q"
            value="{{ search_query|default:'' }}"
            placeholder="Search WBS code, task name, or owner..."
            autocomplete="off"
            class="search-input">
          <div id="search-suggestions" class="autocomplete-dropdown" style="display: none;"></div>
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-group-title">Mode</div>
        <div class="filter-options">
          <label><input type="radio" name="mode" value="none" {% if filter_mode == "none" %}checked{% endif %}> None</label>
          <label><input type="radio" name="mode" value="highlight" {% if filter_mode == "highlight" %}checked{% endif %}> Highlight</label>
          <label><input type="radio" name="mode" value="filter" {% if filter_mode == "filter" %}checked{% endif %}> Filter</label>
        </div>
        <div class="filter-note">Highlight dims non-matching rows; Filter removes them.</div>
      </div>

      <div class="filter-group">
        <label><input type="checkbox" name="items_only" value="1" {% if has_items_only %}checked{% endif %}> Only tasks with Project Items</label>
      </div>

      <div class="filter-group">
        <div class="filter-group-title">Type</div>
        <div class="filter-options">
          {% for val,label in projectitem_type_choices %}
            <label><input type="checkbox" name="type" value="{{ val }}" {% if val in selected_types %}checked{% endif %}> {{ label }}</label>
          {% endfor %}
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-group-title">Status</div>
        <div class="filter-options">
          {% for val,label in projectitem_status_choices %}
            <label><input type="checkbox" name="status" value="{{ val }}" {% if val in selected_statuses %}checked{% endif %}> {{ label }}</label>
          {% endfor %}
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-group-title">Priority</div>
        <div class="filter-options">
          {% for val,label in projectitem_priority_choices %}
            <label><input type="checkbox" name="priority" value="{{ val }}" {% if val in selected_priorities %}checked{% endif %}> {{ label }}</label>
          {% endfor %}
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-group-title">Severity</div>
        <div class="filter-options">
          {% for val,label in projectitem_severity_choices %}
            <label><input type="checkbox" name="severity" value="{{ val }}" {% if val in selected_severities %}checked{% endif %}> {{ label }}</label>
          {% endfor %}
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-group-title">Owner (Resource)</div>
        <div class="filter-options">
          {% for owner in all_owners %}
            <label>
              <input type="checkbox" name="owner" value="{{ owner.id }}" {% if owner.id|stringformat:'s' in selected_owners %}checked{% endif %}>
              {{ owner.label }}
            </label>
          {% endfor %}
          {% if not all_owners %}
            <p style="color: #999; font-style: italic;">No owners assigned yet</p>
          {% endif %}
        </div>
      </div>

      <div class="filter-actions">
        <button type="submit">Apply</button>
        <a href="{% url 'gantt_view' %}">Clear</a>
      </div>
    </form>
  </div>
  <div class="gantt-legend">
    <strong>Dependency types:</strong>
    <span class="legend-item">
      <span class="legend-swatch dep-type-fs"></span> FS
    </span>
    <span class="legend-item">
      <span class="legend-swatch dep-type-ss"></span> SS
    </span>
    <span class="legend-item">
      <span class="legend-swatch dep-type-ff"></span> FF
    </span>
    <span class="legend-item">
      <span class="legend-swatch dep-type-sf"></span> SF
    </span>
    <span class="legend-item">Lag label shown when lag ‚â† 0</span>
    <span class="legend-separator">|</span>
    <span class="legend-item">
      <span class="legend-swatch critical-path-swatch"></span> Critical Path
    </span>
    <span class="legend-item">
      <span class="milestone-icon">‚óÜ</span> Milestone
    </span>
    <span class="legend-separator">|</span>
    <span class="legend-item">
      <span class="baseline-sample baseline-default"></span> Baseline (Actual)
    </span>
    <span class="legend-item">
      <span class="baseline-sample baseline-behind"></span> Behind Schedule
    </span>
    <span class="legend-item">
      <span class="baseline-sample baseline-ahead"></span> Ahead of Schedule
    </span>
  </div>

  <!-- Bulk Actions Toolbar -->
  <div id="bulk-actions-toolbar" class="bulk-actions-toolbar" style="display: none;">
    <div class="bulk-actions-content">
      <span class="bulk-selection-count"><strong id="selected-count">0</strong> tasks selected</span>
      <div class="bulk-action-buttons">
        <button type="button" id="bulk-delete" class="bulk-action-btn" title="Delete selected tasks">
          <span>üóëÔ∏è</span> Delete
        </button>
        <button type="button" id="bulk-export" class="bulk-action-btn" title="Export selected tasks">
          <span>üì•</span> Export
        </button>
        <button type="button" id="bulk-change-status" class="bulk-action-btn" title="Change status">
          <span>üìù</span> Status
        </button>
        <button type="button" id="bulk-assign-owner" class="bulk-action-btn" title="Assign owner">
          <span>üë§</span> Assign
        </button>
        <button type="button" id="bulk-clear" class="bulk-action-btn-secondary" title="Clear selection">
          Clear
        </button>
      </div>
    </div>
  </div>

  <div class="gantt-container">
    <div class="gantt-layout">
      <div class="gantt-main">
        <div class="gantt-scroll">
          <table class="gantt-table">
            <colgroup>
              <col style="width: 40px;">
              <col style="width: 80px;">
              <col style="width: 240px;">
              <col style="width: 120px;">
              <col style="width: 120px;">
              <col style="width: {{ timeline_width_px }}px;">
            </colgroup>
            <thead>
              {% if min_start and max_end %}
                <!-- existing timeline row above headers -->
                <tr class="header-timeline-row">
                  <th colspan="5"></th>
                  <th>
                    <div class="timeline">
                      <div class="timeline-track" style="width: {{ timeline_width_px }}px;">
                        <!-- Year row -->
                        <div class="timeline-row">
                          {% for band in year_bands %}
                            <div class="year-band"
                                 style="left: {{ band.offset_px }}px; width: {{ band.width_px }}px;">
                              {{ band.label }}
                            </div>
                          {% endfor %}
                        </div>
                        <!-- Month row -->
                        <div class="timeline-row">
                          {% for band in month_bands %}
                            <div class="month-band"
                                 style="left: {{ band.offset_px }}px; width: {{ band.width_px }}px;">
                              {{ band.label }}
                            </div>
                          {% endfor %}
                        </div>
                        <!-- Day row -->
                        <div class="timeline-row">
                          {% for tick in day_ticks %}
                            <div class="day-tick" style="left: {{ tick.offset_px }}px;"></div>
                            <div class="day-label" style="left: {{ tick.offset_px }}px;">
                              {{ tick.label }}
                            </div>
                          {% endfor %}
                        </div>
                        <!-- Resource conflict markers -->
                        <div class="timeline-row resource-conflicts-row">
                          {% for detail in resource_conflict_details %}
                            <div class="resource-conflict"
                                 style="left: {{ detail.pos_px }}px;"
                                 data-date="{{ detail.date }}"
                                 data-owners="{{ detail.owner_summary }}"
                                 title="Resource conflict on {{ detail.date }}: {{ detail.owner_summary }}">
                            </div>
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                  </th>
                </tr>
              {% endif %}

              <!-- Column headers row -->
              <tr class="header-cols-row">
                <th class="col-select">
                  <input type="checkbox" id="select-all-tasks" aria-label="Select all tasks" title="Select all">
                </th>
                <th class="col-code">Code</th>
                <th class="col-task">Task</th>
                <th class="col-start">Start</th>
                <th class="col-end">End</th>
                <th class="bar-header"></th>
              </tr>
            </thead>
            <tbody>
              {% for item in tasks %}
                <tr class="gantt-row {% if filter_mode == 'highlight' and not item.matches_filter %}non-matching-highlight{% endif %}"
                    data-code="{{ item.code }}"
                    data-parent-code="{% if item.parent %}{{ item.parent.code }}{% endif %}"
                    data-predecessors="{{ item.predecessor_codes|join:',' }}"
                    data-successors="{{ item.successor_codes|join:',' }}"
                    data-successor-meta="{% for link in item.successor_meta %}{{ link.code }}:{{ link.type }}:{% firstof link.lag 0 %}|{% endfor %}"
                    data-level="{{ item.level }}"
                    data-wbs-name="{{ item.name }}">
                  <td class="col-select">
                    <input type="checkbox" class="task-checkbox" data-code="{{ item.code }}" aria-label="Select {{ item.code }}">
                  </td>
                  <td class="col-code">{{ item.code }}</td>
                  <td class="task-name col-task">
                    {% if item.has_children %}
                      <button type="button"
                              class="expander"
                              data-has-children="true"
                              data-expanded="true"
                              aria-expanded="true"
                              aria-label="Toggle children for {{ item.code }}">
                        ‚ñæ
                      </button>
                    {% else %}
                      <button type="button"
                              class="expander expander-placeholder"
                              data-has-children="false"
                              aria-hidden="true"
                              tabindex="-1">
                        ‚ñ™
                      </button>
                    {% endif %}
                    {% for _ in item.level_indent %}&nbsp;&nbsp;&nbsp;{% endfor %}
                    <span class="task-name-text editable-name" data-code="{{ item.code }}" title="Double-click to edit">{{ item.name }}</span>

                    <!-- Hidden per-row ProjectItem snippets for JS to read -->
                    <div class="hidden-project-items">
                      {% for pi in item.project_items.all %}
                        <div class="project-item"
                             data-type="{{ pi.type }}"
                             data-status="{{ pi.status }}"
                             data-priority="{{ pi.priority }}"
                             data-severity="{{ pi.severity }}">
                          <div class="title">{{ pi.title }}</div>
                          <div class="meta">
                            {% if pi.type %}<span class="pill">{{ pi.get_type_display }}</span>{% endif %}
                            {% if pi.status %}<span class="pill">{{ pi.get_status_display }}</span>{% endif %}
                            {% if pi.priority %}<span class="pill">{{ pi.get_priority_display }}</span>{% endif %}
                          </div>
                          {% if pi.description %}
                            <div class="desc">
                              {{ pi.description|truncatechars:120 }}
                            </div>
                          {% endif %}
                        </div>
                      {% empty %}
                        <!-- no project items -->
                      {% endfor %}
                    </div>
                  </td>
                  <td class="col-start">{{ item.planned_start }}</td>
                  <td class="col-end">{{ item.planned_end }}</td>
                  <td class="bar-cell">
                    {% if item.bar_width %}
                      <div class="bar-wrapper" style="width: {{ timeline_width_px }}px;">
                    {% if item.has_actual_dates %}
                      <div class="baseline-bar"
                           style="margin-left: {{ item.actual_bar_offset }}px; width: {{ item.actual_bar_width }}px;"
                           title="Actual: {{ item.actual_start }} to {{ item.actual_end }}, Variance: {{ item.variance_days }} days"></div>
                    {% endif %}
                    <div class="bar draggable-bar{% if item.is_critical_path %} critical-path{% endif %}{% if item.is_milestone %} milestone{% endif %}"
                         data-code="{{ item.code }}"
                         data-start="{{ item.planned_start|date:'Y-m-d' }}"
                         data-end="{{ item.planned_end|date:'Y-m-d' }}"
                         data-critical="{{ item.is_critical_path|yesno:'true,false' }}"
                         data-milestone="{{ item.is_milestone|yesno:'true,false' }}"
                         data-has-actual="{{ item.has_actual_dates|yesno:'true,false' }}"
                         style="margin-left: {{ item.bar_offset }}px; width: {{ item.bar_width }}px;">
                      {% if item.percent_complete %}
                        <div class="bar-progress"
                             style="width: {{ item.percent_complete|default_if_none:0 }}%;"></div>
                      {% endif %}
                      {% if item.is_milestone %}
                        <div class="milestone-marker" title="Milestone: {{ item.name }}">‚óÜ</div>
                      {% endif %}
                        </div>
                      </div>
                    {% endif %}
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="6">No tasks found.</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
          <svg id="dependency-svg" class="dependency-overlay"></svg>
        </div>
      </div>

      <!-- Right-hand detail panel -->
      <aside class="detail-panel collapsed" id="project-detail-panel">
        <h2>Project Items</h2>
        <div id="detail-task-header">
          <div class="selected-task muted">Click a task row to see its project items.</div>
        </div>
        <div id="detail-project-items">
          <!-- Filled by JS -->
        </div>
      </aside>
    </div>
  </div>

  <!-- Keyboard Shortcuts Help Modal -->
  <div id="keyboard-help-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content keyboard-help-content">
      <div class="modal-header">
        <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
        <button class="close-help" aria-label="Close help">&times;</button>
      </div>
      <div class="modal-body">
        <div class="shortcuts-grid">
          <div class="shortcut-section">
            <h3>Navigation</h3>
            <dl>
              <dt><kbd>‚Üê</kbd> <kbd>‚Üí</kbd></dt>
              <dd>Pan timeline left/right</dd>
              <dt><kbd>‚Üë</kbd> <kbd>‚Üì</kbd></dt>
              <dd>Scroll page up/down</dd>
              <dt><kbd>Home</kbd></dt>
              <dd>Jump to top & timeline start</dd>
              <dt><kbd>End</kbd></dt>
              <dd>Jump to bottom of page</dd>
              <dt><kbd>T</kbd></dt>
              <dd>Jump to today</dd>
            </dl>
          </div>

          <div class="shortcut-section">
            <h3>Zoom</h3>
            <dl>
              <dt><kbd>+</kbd> or <kbd>=</kbd></dt>
              <dd>Zoom in</dd>
              <dt><kbd>-</kbd></dt>
              <dd>Zoom out</dd>
            </dl>
          </div>

          <div class="shortcut-section">
            <h3>View Controls</h3>
            <dl>
              <dt><kbd>D</kbd></dt>
              <dd>Toggle dependencies</dd>
              <dt><kbd>P</kbd></dt>
              <dd>Toggle project items panel</dd>
              <dt><kbd>Esc</kbd></dt>
              <dd>Close modals</dd>
              <dt><kbd>?</kbd></dt>
              <dd>Show this help</dd>
            </dl>
          </div>

          <div class="shortcut-section">
            <h3>Actions</h3>
            <dl>
              <dt><kbd>Ctrl</kbd>+<kbd>O</kbd></dt>
              <dd>Optimize schedule</dd>
              <dt><kbd>Ctrl</kbd>+<kbd>Z</kbd></dt>
              <dd>Undo last date change</dd>
              <dt><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Z</kbd> or <kbd>Ctrl</kbd>+<kbd>Y</kbd></dt>
              <dd>Redo date change</dd>
            </dl>
          </div>
        </div>

        <div class="help-footer">
          <p><strong>Tip:</strong> Keyboard shortcuts work when not typing in an input field.</p>
          <p>Press <kbd>?</kbd> anytime to show this help.</p>
        </div>
      </div>
    </div>
  </div>

</div>
<script src="{% static 'wbs/shared-theme.js' %}?v={{ timestamp }}"></script>
<script src="{% static 'wbs/fetch-utils.js' %}?v={{ timestamp }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script type="module" src="{% static 'wbs/gantt.js' %}?v={{ timestamp }}"></script>
</div>
{% endblock %}
